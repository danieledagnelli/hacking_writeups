from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.keys import Keys
import time
import requests
from bs4 import BeautifulSoup

session = requests.Session()

login_url = "http://eloquia.htb/accounts/login/"
response = session.get(login_url)

soup = BeautifulSoup(response.text, "html.parser")
csrf_token = soup.find("input", {"name": "csrfmiddlewaretoken"})["value"]

payload = {
    "username": "admin",
    "password": "MyEl0qu!@Admin",
    "csrfmiddlewaretoken": csrf_token
    }

post_response = session.post(
    login_url,
    data=payload
    )

session_cookie = session.cookies.get("sessionid")

# Create a new instance of the Chrome driver
chrome_options = Options()
chrome_options.add_argument('--headless')
driver = webdriver.Chrome(options=chrome_options)

response = requests.get("http://eloquia.htb/api/get/reported_articles/")
driver.get(f"http://eloquia.htb/api/get/reported_articles/") # just to set the domain cookie
driver.add_cookie({"name": "sessionid", "value": session_cookie})

for id in str(response.text).split('\n')[:-1]:
    driver.get(f"http://eloquia.htb/article/visit/{id}/")
    button = driver.find_element(by='name', value="report-article")
    button.send_keys(Keys.NULL)
    autofocus_elements = driver.find_elements(by='css selector', value='[autofocus]')
    for element in autofocus_elements:
        try:
            element.send_keys(Keys.NULL)
        except:
            pass

    # Wait for the XSS payload to execute (adjust the delay as needed)
    time.sleep(3)

# Close the browser
driver.quit()
