from .settings import LOGIN_LOG_FILE
from datetime import datetime


def get_client_ip(request):
    x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
    if x_forwarded_for:
        ip = x_forwarded_for.split(',')[0].strip()
    else:
        ip = request.META.get('REMOTE_ADDR')
    return ip


def log_login_attempt(request, username, result):
    ip_address = get_client_ip(request)  # Use IPv4Address instead of ip_address
    current_date = datetime.now()
    formatted_date = current_date.strftime("%Y-%m-%d %H:%M:%S")
    log_message = f'{formatted_date}, {username}, {ip_address}, {result}\n'
    with open(LOGIN_LOG_FILE, "a") as log_file:
        log_file.write(log_message)
        log_file.close()
    return True
